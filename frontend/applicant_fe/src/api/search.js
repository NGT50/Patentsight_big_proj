// src/api/search.js

/**
 * ìœ ì‚¬ íŠ¹í—ˆ ê²€ìƒ‰ (Mock ë²„ì „ - flat êµ¬ì¡° ë³€í™˜)
 * PatentCardê°€ ë°”ë¡œ ì“¸ ìˆ˜ ìˆë„ë¡ ë°ì´í„°ë¥¼ ê°€ê³µí•´ì„œ ë°˜í™˜
 */
export const searchSimilarPatents = async ({ searchQuery, top_n = 5 }) => {
  console.log("ê²€ìƒ‰ì–´:", searchQuery, " top_n:", top_n);

  // ì›ë³¸ mock ë°ì´í„°
  const rawPatents = [
    {
      applicationNumber: "1020120043476",
      basicInfo: {
        inventionTitle: "ìˆ˜ìˆ ìš© ë¡œë´‡",
        applicantName: "ì£¼ì‹íšŒì‚¬ ê³ ì˜í…Œí¬ë†€ëŸ¬ì§€|í•œì–‘ëŒ€í•™êµ ì—ë¦¬ì¹´ì‚°í•™í˜‘ë ¥ë‹¨",
        applicationDate: "20120425",
        astrtCont: "ë¡œë´‡ ì•”ì˜ ëë‹¨ë¶€ì— ì„¤ì¹˜ë˜ëŠ” ë§ë‹¨ì¥ì¹˜ì˜ ìœ„ì¹˜ì— ë”°ë¥¸ RCM í¬ì¸íŠ¸ë¥¼ ìƒê¸° ë§ë‹¨ì¥ì¹˜ ìƒì— ì‚¬ìš©ìê°€ ìœ¡ì•ˆìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ê°€ë³€ì ìœ¼ë¡œ í‘œì‹œí•´ ì¤„ ìˆ˜ ìˆëŠ” ìˆ˜ìˆ  ë¡œë´‡ì´ ê°œì‹œëœë‹¤. ìƒê¸° ìˆ˜ìˆ  ë¡œë´‡ì€ ë§ë‹¨ì¥ì¹˜ì˜ ìœ„ì¹˜ê°€ ë³€ê²½ë˜ë”ë¼ë„ ìƒê¸° RCM í¬ì¸íŠ¸ í‘œì‹œìˆ˜ë‹¨ì— ì˜í•´ ìƒê¸° ë§ë‹¨ì¥ì¹˜ ìƒì— RCM í¬ì¸íŠ¸ê°€ ê°€ë³€ì ìœ¼ë¡œ í‘œì‹œë˜ì–´ ì‚¬ìš©ìê°€ ìƒê¸° ë§ë‹¨ì¥ì¹˜ ìƒì˜ RCM í¬ì¸íŠ¸ë¥¼ ìœ¡ì•ˆìœ¼ë¡œ ì§ì ‘ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ, ìˆ˜ìˆ  ì‹œ ìƒê¸° ë§ë‹¨ì¥ì¹˜ì™€ í™˜ìì˜ ì ˆê°œë¶€ì™€ì˜ ê°„ì„­ í˜„ìƒì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ìƒê¸° RCM í¬ì¸íŠ¸ë¥¼ í™˜ìì˜ ì ˆê°œ ë¶€ìœ„ì™€ ì¼ì¹˜ì‹œí‚¤ëŠ” ì‘ì—…ì„ ë§¤ìš° ìš©ì´í•˜ê³  ì‹ ì†í•˜ê²Œ í•  ìˆ˜ ìˆì–´ ë¡œë´‡ ìˆ˜ìˆ  ì‹œ ìƒê¸° ìˆ˜ìˆ  ë¡œë´‡ì˜ ì„¸íŒ… ì‹œê°„ì„ ëŒ€í­ ì¤„ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì „ì²´ ìˆ˜ìˆ ì‹œê°„ê¹Œì§€ë„ ì¤„ì¼ ìˆ˜ ìˆëŠ” íš¨ê³¼ê°€ ìˆë‹¤.",
        drawing: "http://plus.kipris.or.kr/kiprisplusws/fileToss.jsp?arg=ed43a0609e94d6e22d01c5c32ba711cf9118776b53ad305f8d058a9ca0fd3cb61e7490f1d957bcdf265297316ab471bad4e20946e715ea9a0777d3a4fce530419f0c8ed50381c45c",
        ipcNumber: "A61B 34/00|B25J 13/08",
        registerStatus: "ë“±ë¡"
      }
    },
    {
      applicationNumber: "1020220121028",
      basicInfo: {
        inventionTitle: "ìˆ˜ìˆ  ë¡œë´‡ì˜ ì ˆì‚­ ê²½ë¡œ í”Œë˜ë‹ ì¥ì¹˜ ë° ê·¸ ë°©ë²•",
        applicantName: "íë ‰ì†Œ ì£¼ì‹íšŒì‚¬",
        applicationDate: "20220923",
        astrtCont: "ë³¸ ë°œëª…ì€ ìˆ˜ìˆ  ë¡œë´‡ì˜ ì ˆì‚­ ê²½ë¡œ í”Œë˜ë‹ ì¥ì¹˜ ë° ê·¸ ë°©ë²•ì— ê´€í•œ ê²ƒìœ¼ë¡œ, ë³¸ ë°œëª…ì— ë”°ë¥¸ ìˆ˜ìˆ ë¡œë´‡ì˜ ì ˆì‚­ ê²½ë¡œ í”Œë˜ë‹ ë°©ë²•ì€, ìˆ˜ìˆ ëŒ€ìƒ ë¼ˆì˜ 3D ëª¨ë¸ì„ ê¸°ì´ˆë¡œ ìˆ˜ìˆ ëŒ€ìƒ ë¼ˆì— ì„¤ì¹˜ë  ì„í”Œë€íŠ¸ì˜ ìœ„ì¹˜ ë° ìì„¸ë¥¼ ê²°ì •í•˜ëŠ” ë‹¨ê³„; ìƒê¸° ì„í”Œë€íŠ¸ì˜ ì„¤ì¹˜ë¥¼ ìœ„í•˜ì—¬ ì ˆì‚­ì´ í•„ìš”í•œ ìƒê¸° ìˆ˜ìˆ ëŒ€ìƒ ë¼ˆì˜ ì ˆì‚­ë©´ì„ ê²°ì •í•˜ëŠ” ë‹¨ê³„; ìƒê¸° ì ˆì‚­ë©´ì— ëŒ€í•˜ì—¬ ìˆ˜ìˆ ë¡œë´‡ì´ ì ˆì‚­ì„ ì‹œì‘í•˜ëŠ” ì ˆì‚­ ì‹œì‘ ìœ„ì¹˜ì™€ ìƒê¸° ì ˆì‚­ ì‹œì‘ ìœ„ì¹˜ì—ì„œì˜ ìƒê¸° ìˆ˜ìˆ ë¡œë´‡ì˜ ì§„ì… ë°©í–¥ì„ ê²°ì •í•˜ëŠ” ë‹¨ê³„; ìƒê¸° ì ˆì‚­ ì‹œì‘ ìœ„ì¹˜ì™€ ìƒê¸° ì§„ì… ë°©í–¥ì„ ê¸°ì´ˆë¡œ ìƒê¸° ìˆ˜ìˆ ë¡œë´‡ì— ì˜í•œ ì ˆì‚­ ê²½ë¡œê°€ ì •ì˜ë  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì˜ì—­ì„ ì„¤ì •í•˜ëŠ” ë‹¨ê³„; ìƒê¸° ì ˆì‚­ë©´ì´ ì ˆì‚­ëœ ìƒíƒœê°€ ê°€ìƒìœ¼ë¡œ ë°˜ì˜ëœ ë³€í˜• 3D ëª¨ë¸ì„ ìƒì„±í•˜ëŠ” ë‹¨ê³„; ë° ìƒê¸° ë³€í˜• 3D ëª¨ë¸ì„ ê¸°ì´ˆë¡œ ìƒê¸° ìµœëŒ€ ì˜ì—­ì˜ ë²”ìœ„ ë‚´ì—ì„œ ìƒê¸° ì ˆì‚­ ì‹œì‘ ìœ„ì¹˜ë¡œë¶€í„° ì‹œì‘ë˜ëŠ” ìƒê¸° ìˆ˜ìˆ ë¡œë´‡ì˜ ì ˆì‚­ ê²½ë¡œë¥¼ ìƒì„±í•˜ëŠ” ë‹¨ê³„ë¥¼ í¬í•¨í•œë‹¤. ì´ë¥¼ í†µí•˜ì—¬, í™˜ìì— ë”°ë¥¸ ë¼ˆì˜ ë‹¤ì–‘ì„±ì„ ê³ ë ¤í•œ í™˜ì ë§ì¶¤í˜• ì ˆì‚­ ê²½ë¡œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•¨ìœ¼ë¡œì¨ ìˆ˜ìˆ  íš¨ê³¼ë¥¼ ë”ìš± í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.",
        drawing: "http://plus.kipris.or.kr/kiprisplusws/fileToss.jsp?arg=ed43a0609e94d6e22d01c5c32ba711cfafcbc342afaea4d5870ccdf59b826823313ce68f4420ea243bfe1a59aa3a63cf317575ca5d3b0c44d3c81eaae44e69e1a0b0f47d5efaef8f",
        ipcNumber: "A61B 34/10|A61B 34/30|A61B 34/00",
        registerStatus: "ë“±ë¡"
      }
    },
    {
      applicationNumber: "1020220082162",
      basicInfo: {
        inventionTitle: "ì „ê³„ ì¸ê°€ ì¥ì¹˜",
        applicantName: "ì‚¼ì„±ë””ìŠ¤í”Œë ˆì´ ì£¼ì‹íšŒì‚¬",
        applicationDate: "20201209",
        astrtCont: "ì „ê³„ ì¸ê°€ ì¥ì¹˜ëŠ” ìŠ¤í…Œì´ì§€, ë° ìƒê¸° ìŠ¤í…Œì´ì§€ì˜ ì¼ ì¸¡ì— êµ¬ë¹„ë˜ëŠ” ì „ê³„ ì¸ê°€ ëª¨ë“ˆì„ í¬í•¨í•˜ë˜, ìƒê¸° ì „ê³„ ì¸ê°€ ëª¨ë“ˆì€, í”„ë¡œë¸Œ í—¤ë“œ, ìƒê¸° í”„ë¡œë¸Œ í—¤ë“œì˜ ì œ1 ë©´ ìƒì— ë°°ì¹˜ë˜ëŠ” ì ì–´ë„ í•˜ë‚˜ì˜ í”„ë¡œë¸Œ í•€, ìƒê¸° í”„ë¡œë¸Œ í—¤ë“œì™€ ì œ1 ë°©í–¥ìœ¼ë¡œ ì´ê²©ë˜ì–´ ë°°ì¹˜ë˜ëŠ” ê°€ì´ë“œ í”Œë ˆì´íŠ¸, ë° ìƒê¸° í”„ë¡œë¸Œ í—¤ë“œì™€ ìƒê¸° ê°€ì´ë“œ í”Œë ˆì´íŠ¸ ì‚¬ì´ì— ë°°ì¹˜ë˜ë©°, ìƒê¸° í”„ë¡œë¸Œ í—¤ë“œì™€ ìƒê¸° ê°€ì´ë“œ í”Œë ˆì´íŠ¸ë¥¼ ìƒí˜¸ ì²´ê²°í•˜ê³  í´ë”©ì‹œí‚¤ëŠ” ì²´ê²°ë¶€ë¥¼ í¬í•¨í•œë‹¤.",
        drawing: "http://plus.kipris.or.kr/kiprisplusws/fileToss.jsp?arg=ed43a0609e94d6e22d01c5c32ba711cfc55451d21dba040280978512582e54ce45afaa9940ea5aff4885a5d51a97b17e8f63d5fb0b66d97e88dcb00b47dc2fcbf2f9b79e2eed4430",
        ipcNumber: "G01R 31/28|G01R 1/073|G01R 1/067",
        registerStatus: "ê³µê°œ"
      }
    },
    {
      applicationNumber: "1020160089635",
      basicInfo: {
        inventionTitle: "ìˆ˜ìˆ  ë¡œë´‡ ì‹œìŠ¤í…œ ë° ê·¸ ì œì–´ë°©ë²•",
        applicantName: "(ì£¼)ë¯¸ë˜ì»´í¼ë‹ˆ",
        applicationDate: "20160715",
        astrtCont: "ìˆ˜ìˆ  ë¡œë´‡ ì‹œìŠ¤í…œ ë° ê·¸ ì œì–´ë°©ë²•ì´ ê°œì‹œëœë‹¤. ìˆ˜ìˆ  ë¶€ìœ„ì— ì‚½ì…ë˜ì–´ ìˆ˜ìˆ ì— í•„ìš”í•œ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸(instrument)ì™€, ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ì˜ ì‘ë™ì„ ì œì–´í•˜ëŠ” ì œì–´ë¶€ë¥¼ í¬í•¨í•˜ëŠ” ìˆ˜ìˆ  ë¡œë´‡ ì‹œìŠ¤í…œìœ¼ë¡œì„œ, ì œì–´ë¶€ëŠ” íƒìƒ‰ ëª¨ë“œ(search mode) ë˜ëŠ” ì‘ìš© ëª¨ë“œ(action mode)ì—ì„œ ì‘ë™ë˜ê³ , íƒìƒ‰ ëª¨ë“œì¼ ë•Œ ì œì–´ë¶€ëŠ”, ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ì— ê°€í•´ì§€ëŠ” ì™¸ë ¥ì„ ì„¼ì‹±í•  ìˆ˜ ìˆë„ë¡ ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ì˜ ì‘ë™ì„ ì œì–´í•˜ë©°, ì‘ìš© ëª¨ë“œì¼ ë•Œ ì œì–´ë¶€ëŠ”, ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ê°€ ìˆ˜ìˆ ì— í•„ìš”í•œ ë™ì‘ì„ ìˆ˜í–‰í•˜ë„ë¡ ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ì˜ ì‘ë™ì„ ì œì–´í•˜ëŠ” ê²ƒì„ íŠ¹ì§•ìœ¼ë¡œ í•˜ëŠ” ìˆ˜ìˆ  ë¡œë´‡ ì‹œìŠ¤í…œì€, ìµœì†Œì¹¨ìŠµ ë³µê°•ê²½ ìˆ˜ìˆ ìš© ë¡œë´‡ì—ì„œ ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ë¥¼ ì œì–´í•˜ëŠ” ë°©ì‹ì„ íƒìƒ‰ ëª¨ë“œì™€ ì‘ìš© ëª¨ë“œë¡œ êµ¬ë¶„í•˜ì—¬, íƒìƒ‰ ëª¨ë“œì‹œ ìˆ˜ìˆ  ë¶€ìœ„ ë° ì²´ë‚´ ì¡°ì§ ë¶€ìœ„ì™€ ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ê°€ ì ‘ì´‰í•˜ëŠ” ìƒí˜¸ ì‘ìš© ê³¼ì •ì—ì„œ ì¸ìŠ¤íŠ¸ë£¨ë¨¼íŠ¸ì— ì‘ìš©í•˜ëŠ” ë°˜ë ¥ì„ ì¸¡ì •í•˜ì—¬, ê·¸ ì •ë„ë¥¼ ìŠ¤ì½”í”„ í™”ë©´ ìƒì— í‘œì‹œí•˜ê±°ë‚˜ ë§ˆìŠ¤í„° ì½˜ì†”ì— ì¸¡ì •ëœ ë°˜ë ¥ì„ í”¼ë“œë°±ì‹œì¼œ ì§‘ë„ì˜ê°€ ì´ë¥¼ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆë‹¤.",
        drawing: "http://plus.kipris.or.kr/kiprisplusws/fileToss.jsp?arg=ed43a0609e94d6e22d01c5c32ba711cf180e368476a00bc24a2bef232365eb08c1fb7f0b94653d18e8563235341c8ba820ae9f93e8040e277a67dbcd2d51ff3963c94911bdd52f42",
        ipcNumber: "A61B 34/30|A61B 34/35|A61B 34/00",
        registerStatus: "ë“±ë¡"
      }
    },
    {
      applicationNumber: "1020240170032",
      basicInfo: {
        inventionTitle: "ìˆ˜ìˆ  ë¡œë´‡ ì‹œìŠ¤í…œ",
        applicantName: "ì£¼ì‹íšŒì‚¬ ë¡œì—”ì„œì§€ì»¬",
        applicationDate: "20241125",
        astrtCont: "ë³¸ ë°œëª…ì€ ìˆ˜ìˆ  ë¡œë´‡ ì‹œìŠ¤í…œ ë° ê·¸ ì œì–´ë°©ë²•ì— ê´€í•œ ê²ƒì´ë‹¤. ë³¸ ë°œëª…ì˜ ìˆ˜ìˆ  ë¡œë´‡ ì‹œìŠ¤í…œì€ ë³µìˆ˜ì˜ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ êµ¬ë™ì‹œí‚¤ëŠ” ì œì–´ ì •ë³´ê°€ í¬í•¨ëœ ë°ì´í„°ê·¸ë¨ ì»¤ë§¨ë“œë¥¼ ì†¡ì‹ í•˜ëŠ” ë¶„ë°° ëª¨ë“ˆ, ìƒê¸° ë°ì´í„°ê·¸ë¨ ì»¤ë§¨ë“œë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì œ1 êµ¬ë™ì‹ í˜¸ë¥¼ ì¶œë ¥í•˜ê³  í„°ë¯¸ë„ ëª¨ë“ˆë¡œ ì†¡ì‹ í•˜ëŠ” ì»¨í‹°ë‰´ì—„ ëª¨ë“ˆ, ë° ìƒê¸° ë°ì´í„°ê·¸ë¨ ì»¤ë§¨ë“œë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì œ2 êµ¬ë™ì‹ í˜¸ë¥¼ ì¶œë ¥í•˜ëŠ” í„°ë¯¸ë„ ëª¨ë“ˆì„ í¬í•¨í•œë‹¤. ë˜í•œ, ë³¸ ë°œëª…ì€ ê°€ë™ í”Œë«í¼ì— ì¥ì°©ë˜ëŠ” ë³‘ì§„ ëª¨ë“ˆê³¼, ìƒê¸° ë³‘ì§„ ëª¨ë“ˆì— ì¥ì°©ë˜ì–´ ìŠ¤íŠ¸ë¡œí¬ êµ¬ê°„ ë‚´ì—ì„œ ë³‘ì§„ ìš´ë™í•˜ëŠ” ë³µìˆ˜ì˜ êµ¬ë™ ëª¨ë“ˆì„ í¬í•¨í•˜ëŠ” ëª¨ë“ˆëŸ¬ ë§¤ë‹ˆí“°ë ˆì´í„° ì–´ì…ˆë¸”ë¦¬ë¥¼ ì œê³µí•œë‹¤. ìƒê¸° êµ¬ë™ ëª¨ë“ˆì—ëŠ” ì˜¤ë²„íŠœë¸Œ ëª¨ë“ˆê³¼ ìˆ˜ìˆ ê¸°êµ¬ ëª¨ë“ˆì´ ì¥ì°©ë˜ë©°, ìˆ˜ìˆ ê¸°êµ¬ëŠ” ì˜¤ë²„íŠœë¸Œë¡œ ê´€ì…ë˜ì–´ ê°€ì´ë“œëœë‹¤. ì˜¤ë²„íŠœë¸Œì™€ ìˆ˜ìˆ ê¸°êµ¬ê°€ ë‹¨ì¼ ì–´ì…ˆë¸”ë¦¬ë¡œ í†µí•©ë˜ì–´ ê³µê°„ íš¨ìœ¨ì„±ì´ ì¦ëŒ€ë˜ë©°, ìˆ˜ìˆ ê¸°êµ¬ êµì²´ì‹œì—ë„ ë³„ë„ì˜ ì œì–´ íŒ¨í‚· ë³€ê²½ì´ ë¶ˆí•„ìš”í•˜ì—¬ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ì´ í–¥ìƒë  ìˆ˜ ìˆë‹¤.",
        drawing: "http://plus.kipris.or.kr/kiprisplusws/fileToss.jsp?arg=ed43a0609e94d6e22d01c5c32ba711cf10add4f4d6d868b31d7afc1cbe6808c324cb9aa7e94b6662c6031a9109bba104d874bbb6b3bada112560a96d6112f8bc8095cb1e0fd01c16",
        ipcNumber: "A61B 34/30|A61B 34/37|A61B 34/00|A61B 17/00",
        registerStatus: "ê³µê°œ"
      }
    }
  ];

  // ğŸ”¹ PatentCardì—ì„œ ë°”ë¡œ ì“¸ ìˆ˜ ìˆë„ë¡ flat êµ¬ì¡°ë¡œ ë³€í™˜
  const patents = rawPatents.map((p, idx) => ({
    id: idx + 1,
    title: p.basicInfo?.inventionTitle || "ì œëª© ì—†ìŒ",
    inventor: p.basicInfo?.applicantName || "ì¶œì›ì¸ ì •ë³´ ì—†ìŒ",   // âœ… í‚¤ ì´ë¦„ì„ applicant ë¡œ ë³€ê²½
    summary: p.basicInfo?.astrtCont || "ìš”ì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",
    image: p.basicInfo?.drawing || null,
    ipc: p.basicInfo?.ipcNumber || "N/A",
    status: p.basicInfo?.registerStatus || "N/A",
    applicationNumber: p.applicationNumber || "N/A",
    applicationDate: p.basicInfo?.applicationDate || "N/A"
  }));

  return {
    answer: `"${searchQuery}" ê´€ë ¨ ì£¼ìš” íŠ¹í—ˆ ${Math.min(top_n, patents.length)}ê±´ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`,
    patents
  };
};

